<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Kalkulator Determinan</title>
  <style>
    :root{
      --bg:#0f1724;
      --card:#0b1220;
      --accent:#06b6d4;
      --muted:#94a3b8;
      --glass: rgba(255,255,255,0.03);
      --success:#10b981;
      --danger:#ef4444;
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    body{
      margin:0;
      min-height:100vh;
      background:linear-gradient(180deg,#071126 0%, #0b1220 100%);
      color:#e6eef8;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:28px;
    }
    .app {
      width:100%;
      max-width:940px;
      background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:14px;
      padding:20px;
      box-shadow: 0 8px 30px rgba(2,6,23,0.7);
      border:1px solid rgba(255,255,255,0.03);
    }
    header{
      display:flex;
      gap:14px;
      align-items:center;
      justify-content:space-between;
      margin-bottom:12px;
    }
    h1{
      font-size:20px;
      margin:0;
      display:flex;
      gap:10px;
      align-items:center;
    }
    .brand-badge{
      font-size:13px;
      color:var(--accent);
      background:rgba(6,182,212,0.07);
      padding:6px 10px;
      border-radius:9px;
      border:1px solid rgba(6,182,212,0.12);
    }
    .controls{
      display:flex;
      gap:10px;
      align-items:center;
    }
    .segmented{
      background:var(--glass);
      padding:6px;
      border-radius:10px;
      display:flex;
      gap:6px;
    }
    .segmented button{
      background:transparent;
      color:var(--muted);
      border:0;
      padding:8px 12px;
      border-radius:8px;
      cursor:pointer;
      font-weight:600;
    }
    .segmented button.active{
      background:linear-gradient(90deg, rgba(6,182,212,0.12), rgba(6,182,212,0.06));
      color:var(--accent);
      box-shadow: 0 4px 14px rgba(6,182,212,0.06);
    }
    .layout{
      display:grid;
      grid-template-columns: 1fr 360px;
      gap:18px;
      align-items:start;
    }
    .panel{
      background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.02));
      padding:16px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,0.02);
    }
    .matrix-wrap{
      display:flex;
      gap:16px;
      align-items:flex-start;
      flex-wrap:wrap;
    }
    .matrix{
      background:rgba(255,255,255,0.02);
      padding:10px;
      border-radius:10px;
      display:grid;
      gap:8px;
    }
    .matrix input{
      width:64px;
      height:40px;
      padding:6px;
      border-radius:8px;
      border:1px solid rgba(255,255,255,0.06);
      background:transparent;
      color:var(--accent);
      text-align:center;
      font-weight:700;
      font-size:16px;
    }
    .matrix.small input{ width:56px; height:36px; }
    .label { font-size:13px; color:var(--muted); margin-bottom:6px; }
    .btn-row{
      display:flex;
      gap:8px;
      margin-top:12px;
      flex-wrap:wrap;
    }
    .btn{
      padding:10px 14px;
      border-radius:10px;
      cursor:pointer;
      border:0;
      font-weight:700;
    }
    .btn.primary{ background:var(--accent); color:#04232a; }
    .btn.ghost{ background:transparent; color:var(--accent); border:1px solid rgba(6,182,212,0.12); }
    .btn.danger{ background:var(--danger); color:white; }
    .result{
      white-space:pre-wrap;
      font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", monospace;
      background: linear-gradient(90deg, rgba(255,255,255,0.012), rgba(255,255,255,0.02));
      padding:12px;
      border-radius:8px;
      border:1px solid rgba(255,255,255,0.02);
      color:#dff8f9;
      min-height:120px;
      overflow:auto;
    }
    .small-muted{ font-size:13px; color:var(--muted); margin-top:8px; }
    footer{ margin-top:14px; text-align:right; color:var(--muted); font-size:13px; }
    @media (max-width:880px){
      .layout{ grid-template-columns: 1fr; }
      .matrix input{ width:56px; }
    }
  </style>
</head>
<body>
  <div class="app" role="application" aria-label="Kalkulator Determinan">
    <header>
      <h1>
        Kalkulator Determinan ðŸ”¢
        <span class="brand-badge">Aljabar Linier â€¢ Determinan â€¢ SPL</span>
      </h1>
      <div class="controls">
        <div class="segmented" role="tablist" aria-label="Pilih Ordo">
          <button id="ord2" class="active" data-ord="2">Ordo 2Ã—2</button>
          <button id="ord3" data-ord="3">Ordo 3Ã—3</button>
        </div>
      </div>
    </header>

    <div class="layout">
      <div class="panel">
        <div class="label">Masukkan elemen matriks A</div>
        <div class="matrix-wrap">
          <!-- Matrix container (akan diisi oleh JS) -->
          <div id="matrixContainer"></div>

          <!-- Kolom konstanta b untuk SPL -->
          <div>
            <div class="label">Konstanta (vektor b)</div>
            <div id="bContainer" class="matrix small"></div>
            <div class="small-muted">Kolom b digunakan saat tombol <strong>Hitung SPL</strong> ditekan.</div>
          </div>
        </div>

        <div class="btn-row">
          <button id="calcDet" class="btn primary">Hitung Determinan</button>
          <button id="calcSPL" class="btn ghost">Hitung SPL (Kramer's Rule)</button>
          <button id="clearBtn" class="btn" style="background:rgba(255,255,255,0.03); color:var(--muted)">Reset</button>
          <button id="printBtn" class="btn" style="margin-left:auto; background:#111827; color:var(--accent); border:1px solid rgba(6,182,212,0.08)">Print Hasil</button>
        </div>

      </div>

      <div class="panel">
        <div class="label">Hasil & Langkah Perhitungan</div>
        <div id="result" class="result">Belum ada perhitungan. Pilih ordo, masukkan nilai, lalu tekan "Hitung Determinan" atau "Hitung SPL".</div>
        <div id="summary" class="small-muted"></div>
      </div>
    </div>

    <footer style="text-align:center;"> Dibuat untuk: Tugas Aljabar Linier: Determinan Matriks â€¢ Menggunakan metode determinan & Kramer's rule.</footer>
    <footer style="text-align:center;"> Oleh: Syaiful Huda â€¢ Universitas Hayam Wuruk Perbanas Surabaya </footer>
  </div>

  <script>
    // ======= Utilities =======
    const q = (s) => document.querySelector(s);
    const matrixContainer = q('#matrixContainer');
    const bContainer = q('#bContainer');
    const resultEl = q('#result');
    const summaryEl = q('#summary');

    let order = 2; // default

    // ======= Render inputs based on order =======
    function renderMatrixInputs(n){
      matrixContainer.innerHTML = '';
      bContainer.innerHTML = '';
      // Create matrix grid element
      const matrixDiv = document.createElement('div');
      matrixDiv.className = 'matrix';
      matrixDiv.style.gridTemplateColumns = `repeat(${n}, auto)`;
      matrixDiv.setAttribute('aria-label', `Matriks ${n}x${n}`);
      // create inputs for A
      for(let r=0;r<n;r++){
        for(let c=0;c<n;c++){
          const input = document.createElement('input');
          input.type = 'text';
          input.inputMode = 'numeric';
          input.setAttribute('data-row', r);
          input.setAttribute('data-col', c);
          input.setAttribute('aria-label', `A[${r+1},${c+1}]`);
          input.value = (r===c) ? (n===2 ? '1' : (r===0 && c===0 ? '1' : '')) : ''; // small convenience
          matrixDiv.appendChild(input);
        }
      }
      matrixContainer.appendChild(matrixDiv);

      // create inputs for b (constants) - column
      const bDiv = document.createElement('div');
      bDiv.className = 'matrix small';
      bDiv.style.gridTemplateColumns = `1fr`;
      for(let r=0;r<n;r++){
        const input = document.createElement('input');
        input.type = 'text';
        input.inputMode = 'numeric';
        input.setAttribute('data-row', r);
        input.setAttribute('aria-label', `b[${r+1}]`);
        input.value = (r===0) ? '0' : ''; // convenience
        bDiv.appendChild(input);
      }
      bContainer.appendChild(bDiv);
    }

    // initialize
    renderMatrixInputs(order);

    // segmented control
    q('#ord2').addEventListener('click', ()=> setOrder(2));
    q('#ord3').addEventListener('click', ()=> setOrder(3));
    function setOrder(n){
      order = n;
      document.querySelectorAll('.segmented button').forEach(btn => btn.classList.remove('active'));
      q(`#ord${n}`).classList.add('active');
      renderMatrixInputs(n);
      clearResult();
    }

    // ======= Parsing inputs =======
    function parseMatrix(){
      const inputs = matrixContainer.querySelectorAll('input');
      const n = order;
      const A = Array.from({length:n}, ()=> Array(n).fill(0));
      for(const inp of inputs){
        const r = Number(inp.getAttribute('data-row'));
        const c = Number(inp.getAttribute('data-col'));
        const val = parseNumber(inp.value);
        if (val === null) throw new Error(`Input A[${r+1},${c+1}] bukan angka`);
        A[r][c] = val;
      }
      return A;
    }
    function parseB(){
      const inputs = bContainer.querySelectorAll('input');
      const b = [];
      for(const inp of inputs){
        const r = Number(inp.getAttribute('data-row'));
        const val = parseNumber(inp.value);
        if (val === null) throw new Error(`Input b[${r+1}] bukan angka`);
        b[r] = val;
      }
      return b;
    }
    function parseNumber(s){
      if (s === null || s === undefined) return null;
      s = s.toString().trim();
      if (s === '') return null;
      // accept decimals and negative
      const num = Number(s);
      return Number.isFinite(num) ? num : null;
    }

    // ======= Determinant functions =======
    function det2(A){
      // A is 2x2
      return A[0][0]*A[1][1] - A[0][1]*A[1][0];
    }
    function det3(A){
      // Sarrus' rule
      const a = A;
      const d = 
        a[0][0]*a[1][1]*a[2][2] +
        a[0][1]*a[1][2]*a[2][0] +
        a[0][2]*a[1][0]*a[2][1] -
        a[0][2]*a[1][1]*a[2][0] -
        a[0][0]*a[1][2]*a[2][1] -
        a[0][1]*a[1][0]*a[2][2];
      return d;
    }
    function determinant(A){
      if (A.length === 2) return det2(A);
      if (A.length === 3) return det3(A);
      throw new Error('Ordo matrix tidak didukung.');
    }

    // ======= Cramer's Rule (SPL) =======
    function solveByCramer(A, b){
      const n = A.length;
      const D = determinant(A);
      if (D === 0) return { solvable: false, D };

      // helper to clone & replace column j with b
      function replacedDet(j){
        const B = A.map(row => row.slice());
        for(let i=0;i<n;i++) B[i][j] = b[i];
        return determinant(B);
      }
      const Ds = [];
      for(let j=0;j<n;j++){
        Ds[j] = replacedDet(j);
      }
      const x = Ds.map(dj => dj / D);
      return { solvable: true, D, Ds, x };
    }

    // ======= UI: Actions =======
    function clearResult(){
      resultEl.textContent = 'Belum ada perhitungan. Pilih ordo, masukkan nilai, lalu tekan "Hitung Determinan" atau "Hitung SPL".';
      summaryEl.textContent = '';
    }

    q('#clearBtn').addEventListener('click', ()=> {
      renderMatrixInputs(order);
      clearResult();
    });

    q('#calcDet').addEventListener('click', ()=> {
      try{
        const A = parseMatrix();
        const D = determinant(A);
        const steps = generateDetSteps(A);
        resultEl.innerHTML = `=== Determinan (${order}Ã—${order}) ===\n\n` + steps + `\n\nDet(A) = ${formatNumber(D)}`;
        summaryEl.textContent = `Determinant dihitung untuk matriks ${order}Ã—${order}.`;
      }catch(e){
        showError(e.message);
      }
    });

    q('#calcSPL').addEventListener('click', ()=> {
      try{
        const A = parseMatrix();
        const b = parseB();
        const D = determinant(A);
        if (D === 0){
          // Show steps too
          const steps = generateDetSteps(A);
          resultEl.innerHTML = `=== Determinan (${order}Ã—${order}) ===\n\n${steps}\n\nDet(A) = 0\n\nKarena determinan = 0, sistem mungkin tidak memiliki solusi unik (tidak dapat diselesaikan dengan aturan Cramer).`;
          summaryEl.textContent = 'Determinant A = 0 â†’ aturan Cramer tidak dapat diterapkan (tidak ada solusi unik).';
          return;
        }
        const sol = solveByCramer(A,b);
        // Build explanation
        let out = `=== Sistem Persamaan Linear (SPL) â€¢ Aturan Cramer ===\n\nMatriks A (${order}Ã—${order}):\n`;
        out += matrixToString(A) + '\nVektor b:\n' + vectorToString(b) + '\n\n';
        out += `Det(A) = ${formatNumber(D)}\n\n`;
        sol.Ds.forEach((Dj, idx) => {
          out += `Det(A_${idx+1}) = ${formatNumber(Dj)}\n`;
        });
        out += '\nSolusi (x):\n';
        sol.x.forEach((xi, idx) => {
          out += `x${idx+1} = Det(A_${idx+1}) / Det(A) = ${formatNumber(sol.Ds[idx])} / ${formatNumber(D)} = ${formatNumber(xi)}\n`;
        });
        resultEl.innerText = out;
        summaryEl.textContent = `Sistem punya solusi unik (Det(A) = ${formatNumber(D)}).`;
      }catch(e){
        showError(e.message);
      }
    });

    q('#printBtn').addEventListener('click', ()=> {
      // print only result panel
      const content = `
        <html><head><title>Hasil - Kalkulator Determinan</title>
        <style>
          body{ font-family: Arial, Helvetica, sans-serif; padding:20px; color:#111; }
          pre{ white-space:pre-wrap; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", monospace; background:#f6f9fb; padding:16px; border-radius:8px; border:1px solid #e1e8ee; }
          h2{ color:#0a3b3f; }
        </style>
        </head><body>
        <h2>Kalkulator Determinan â€” Hasil</h2>
        <p>Ordo: ${order}Ã—${order}</p>
        <pre>${escapeHtml(resultEl.innerText)}</pre>
        <p>Dicetak: ${new Date().toLocaleString('id-ID')}</p>
        </body></html>
      `;
      const w = window.open('', '_blank');
      w.document.open();
      w.document.write(content);
      w.document.close();
      w.focus();
      // trigger print then close (user may cancel)
      w.print();
    });

    function showError(msg){
      resultEl.textContent = 'Error: ' + msg;
      summaryEl.textContent = '';
    }

    // ======= Helpers for steps and formatting =======
    function generateDetSteps(A){
      const n = A.length;
      if (n === 2){
        const a = A;
        const ad = a[0][0] * a[1][1];
        const bc = a[0][1] * a[1][0];
        return `| ${a[0][0]}  ${a[0][1]} |\n| ${a[1][0]}  ${a[1][1]} |\n\nDet = a11*a22 - a12*a21 = (${a[0][0]})*(${a[1][1]}) - (${a[0][1]})*(${a[1][0]}) = ${formatNumber(ad)} - ${formatNumber(bc)} = ${formatNumber(ad-bc)}`;
      } else if (n === 3){
        const m = A;
        const termsPos = [
          `${m[0][0]}*${m[1][1]}*${m[2][2]}`,
          `${m[0][1]}*${m[1][2]}*${m[2][0]}`,
          `${m[0][2]}*${m[1][0]}*${m[2][1]}`
        ];
        const termsNeg = [
          `${m[0][2]}*${m[1][1]}*${m[2][0]}`,
          `${m[0][0]}*${m[1][2]}*${m[2][1]}`,
          `${m[0][1]}*${m[1][0]}*${m[2][2]}`
        ];
        const valPos = [
          m[0][0]*m[1][1]*m[2][2],
          m[0][1]*m[1][2]*m[2][0],
          m[0][2]*m[1][0]*m[2][1]
        ];
        const valNeg = [
          m[0][2]*m[1][1]*m[2][0],
          m[0][0]*m[1][2]*m[2][1],
          m[0][1]*m[1][0]*m[2][2]
        ];
        let s = `| ${m[0][0]}  ${m[0][1]}  ${m[0][2]} |\n| ${m[1][0]}  ${m[1][1]}  ${m[1][2]} |\n| ${m[2][0]}  ${m[2][1]}  ${m[2][2]} |\n\nAturan Sarrus (penjumlahan positif - penjumlahan negatif):\n\nPositif:\n`;
        termsPos.forEach((t,i)=> s += `  ${t} = ${formatNumber(valPos[i])}\n`);
        s += `\nNegatif:\n`;
        termsNeg.forEach((t,i)=> s += `  ${t} = ${formatNumber(valNeg[i])}\n`);
        const sumPos = valPos.reduce((a,b)=>a+b,0);
        const sumNeg = valNeg.reduce((a,b)=>a+b,0);
        s += `\nDet = (${sumPos}) - (${sumNeg}) = ${formatNumber(sumPos - sumNeg)}`;
        return s;
      } else {
        return 'Langkah perhitungan tidak tersedia untuk ordo > 3.';
      }
    }

    function matrixToString(A){
      return A.map(row => '| ' + row.map(v => formatNumber(v)).join('  ') + ' |').join('\n');
    }
    function vectorToString(b){
      return '| ' + b.map(v => formatNumber(v)).join(' |\n| ') + ' |';
    }
    function formatNumber(x){
      if (Number.isInteger(x)) return x.toString();
      // Round to reasonable digits
      return Number(Math.round((x + Number.EPSILON) * 1e12) / 1e12).toString();
    }
    function escapeHtml(s){
      return s.replace(/[&<>"']/g, function(m){ return ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'})[m]; });
    }

    // Accessibility: focus first input after render
    matrixContainer.addEventListener('DOMNodeInserted', ()=> {
      const first = matrixContainer.querySelector('input');
      if (first) first.focus();
    });
  </script>
</body>
</html>
